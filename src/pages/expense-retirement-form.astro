---
import Layout from "../layouts/Layout.astro";
---

<Layout title="HRPayHub :: Expense Retirement Form">
  <!-- Main content starts here -->
  <main>
    <!-- First section of Back button and Breadcrumb -->
    <section class="p-4">
      <div class="screenFrame">
        <!-- Back Navigation button and BreadCrumbs -->
        <div class="d-flex gap-5">
          <a
            href="index.html"
            title="Back to Dashboard"
            class="d-flex gap-2 align-items-center text-decoration-none text-primary-dark"
          >
            <img src="images/png/icons/angle-left.svg" alt="angle-left-back" />
            <span class="fs-16 fw-bold font-avenir-bold">Back</span>
          </a>

          <!-- Actual Breadcrumb here -->
          <div class="d-flex align-items-center gap-2">
            <a
              href="index.html"
              class="fs-14 text-decoration-none text-primary-dark">Dashboard</a
            >
            <img
              src="images/png/icons/angle-right.svg"
              alt="angle-right-back"
            />
            <a
              href="/expense-management"
              class="fs-14 text-decoration-none text-primary-dark"
              >Expense Management</a
            >
            <img
              src="images/png/icons/angle-right.svg"
              alt="angle-right-back"
            />
            <a
              href="/expense-retirement-request"
              class="fs-14 text-decoration-none text-primary-dark"
              >Expense Retirement Request</a
            >
            <img
              src="images/png/icons/angle-right.svg"
              alt="angle-right-back"
            />
            <span class="fs-16 fw-bold text-primary-blue"
              >Expense Retirement Form</span
            >
          </div>
          <!-- Actual Breadcrumb here -->
        </div>
        <!-- Back Navigation button and BreadCrumbs -->
      </div>
    </section>
    <!-- First section of Back button and Breadcrumb -->

    <!-- First section of Back button and Breadcrumb -->
    <section class="px-4" id="new_user_account">
      <div class="screenFrame">
        <div class="rounded-4 shadow p-4 vstack gap-5 px-5">
          {/* Page Content Box */}
          <div class="p-lg-5">
            <div class="vstack" style="gap: 2.3rem">
              <!------ Add new --->
              {/* Page Title */}
              <div class="vstack gap-3">
                <div class="d-flex gap-3 align-items-center">
                  <span class="text-dark font-ubuntu-bold fs-18 inline-block"
                    >Expense Retirement Form</span
                  >
                </div>
              </div>
              {/* Page Title */}
              <div class="form-floating expense_retirement_input">
                <select
                  id="select_plan"
                  name="select_plan"
                  class="form-select_custom fs-14"
                  required
                >
                  <option value="" selected style="color: rgb(200, 200, 200)"
                    >Select</option
                  >
                  <option value="plan_1">Mixed</option>
                  <option value="plan_2">Cost of Goods Sold (COGS)</option>
                  <option value="plan_3">OPEX</option>
                  <option value="plan_3">ASSET</option>
                </select>
                <label for="select_plan"
                  >Expense Title &nbsp;<span>*</span></label
                >
              </div>
            </div>
            <div
              class="d-flex justify-content-end gap-4 mt-5 expense_retirement_input"
            >
              <button
                class="delon-primary-btn bg-primary-blue border-0 text-white fw-bold fs-14 viewUserBtn"
              >
                <span>Validate</span>
              </button>
            </div>
          </div><!-- End of Global Roles -->
        </div>
      </div>
      {/* Page Content Box */}
    </section>

    <!------- New User form ---->

    <section className="px-4">
      <div className="screenFrame">
        <div
          class="rounded-4 d-none shadow p-4 vstack gap-5 px-5 mx-4"
          id="view_user_form"
        >
          {/* Page Content Box */}
          <div class="p-lg-5">
            <div class="vstack" style="gap: 2.3rem">
              {/* Page Title */}
              <div class="vstack gap-3">
                <div class="d-flex gap-3 align-items-center">
                  <span class="text-dark font-ubuntu-bold fs-18 inline-block"
                    >Expense Retirement Form</span
                  >
                </div>
              </div>
              {/* Page Title */}

              <!---- body ---->
              <div class="form-floating expense_retirement_input">
                <input
                  type="text"
                  id="ex_title"
                  name="ex_title"
                  class="form-input"
                  placeholder=""
                />
                <label for="ex_title">Expense Title &nbsp;<span>*</span></label>
              </div>

              <div class="form-floating expense_retirement_input">
                <select
                  id="select_plan"
                  name="select_plan"
                  class="form-select_custom fs-14"
                  required
                >
                  <option value="" selected style="color: rgb(200, 200, 200)"
                    >Select</option
                  >
                  <option value="plan_1">Mixed</option>
                  <option value="plan_2">Cost of Goods Sold (COGS)</option>
                  <option value="plan_3">OPEX</option>
                  <option value="plan_3">ASSET</option>
                </select>
                <label for="select_plan"
                  >Expense Category &nbsp;<span>*</span></label
                >
              </div>

              <div class="form-floating expense_retirement_input">
                <input
                  type="text"
                  id="amount"
                  name="amount"
                  class="form-input"
                  placeholder=""
                />
                <label for="ex_title"
                  >Original Approved Amount &nbsp;<span>*</span></label
                >
              </div>
              <div class="form-floating expense_retirement_input">
                <input
                  type="text"
                  id="amount"
                  name="amount"
                  class="form-input"
                  placeholder=""
                />
                <label for="amount">Amount Retired &nbsp;<span>*</span></label>
              </div>
              <div class="form-floating expense_retirement_input">
                <input
                  type="text"
                  id="amount"
                  name="amount"
                  class="form-input"
                  placeholder=""
                />
                <label for="amount">Excess Amount &nbsp;<span>*</span></label>
              </div>
              <div class="form-floating expense_retirement_input">
                <input
                  type="text"
                  id="refund_amount"
                  name="refund_amount"
                  class="form-input"
                  placeholder=""
                />
                <label for="refund_amount"
                  >Refund Amount &nbsp;<span>*</span></label
                >
              </div>

              <!----- Expense Breakdown line ----->

              <div
                class="d-flex align-items-center justify-content-center gap-3 expense_retirement_input"
              >
                <span class="breakdown_line"></span>
                <span class="fs-14 fw-600 text-nowrap">Expense Breakdown</span>
                <span class="breakdown_line"></span>
              </div>

              <div class="d-flex gap-4 align-items-center">
                <span class="fs-14">Upload Template from File</span>
                <div
                  role="button"
                  class="form-check form-switch switchForDeductionsFields"
                  style="margin-top: 5px; cursor: pointer"
                >
                  <input
                    class="form-check-input"
                    type="checkbox"
                    role="switch"
                    id="toggleSwitch"
                  />
                </div>
              </div>

              <div id="upload" style="display: none;">
                <!---- upload ---->
                <form class="vstack gap-2" id="generate_payslip_form">
                  <div class="fs-14 fw-600">
                    Download the <a
                      style="color: #2271B6"
                      class="text-decoration-none"
                      href="/offer_letter_template.xls"
                      download>template here</a
                    > and upload the prepared file
                  </div>
                  <div
                    class="upload_bucket_expense_retirement p-3 d-flex flex-column align-items-center justify-content-center"
                  >
                    <img
                      src="images/png/icons/cloud_upload.svg"
                      width="35px"
                      height="35px"
                      alt="cloud upload icon"
                    />
                    <div class="fs-14 fw-700" style="color: #6B7280">
                      Click to upload <span class="fw-400"
                        >or drag and drop</span
                      >
                    </div>

                    <button
                      type="button"
                      id="fileInputBtn"
                      class="delon-primary-btn d-flex gap-2 mt-2 bg-primary-blue border-0 text-white fs-14"
                    >
                      <img src="images/png/icons/search.svg" alt="arrow-down" />
                      <span>Browse Files</span>
                    </button>
                    <div
                      id="fileInputDetails"
                      class="d-none flex-shrink-1 bg-transparent border text-wrap w-100 py-1 px-2 mt-2 rounded-3 fs-14 d-flex gap-1 align-items-center"
                      role="button"
                    >
                      <span class="flex-fill text-truncate"
                        >gvfyguytctrcjrct.webp</span
                      >
                      <span class="flex-fill">
                        <img
                          src="images/png/icons/close-circle-6.svg"
                          width="15"
                          height="15"
                          alt="close_icon"
                        />
                      </span>
                    </div>
                    <input type="file" class="d-none" id="fileInput" />
                  </div>
                </form>
              </div>

              <!---- Accordion ---->
              <div id="accordion">
                <div
                  class="accordion accordion-flush d-flex flex-column gap-3 expense_retirement_input"
                  id="holidayAccordion"
                >
                </div>

                <!------ button ------->
                <div
                  class="d-flex justify-content-between gap-4 mt-3 expense_retirement_input"
                >
                  <button
                    type="button"
                    class="white_button fs-14"
                    style="width: 182px"
                  >
                    <span>Download Breakdown</span>
                  </button>
                  <div class="d-flex justify-content-end align-items-center">
                    <button
                      type="button"
                      class="white_button fs-14 d-flex gap-1 align-items-center"
                      id="deleteHoliday"
                      style="border: 0px !important;"
                    >
                      <span>Delete </span>
                      <img
                        src="images/png/icons/colored/delete.svg"
                        alt="delete"
                      />
                    </button>
                    <button
                      type="button"
                      class="white_button fs-14 d-flex gap-1 align-items-center"
                      id="addNewHoliday"
                      style="border: 0px !important;"
                    >
                      <span>Add New </span>
                      <img src="images/png/icons/add.svg" alt="add new" />
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script is:inline type="text/javascript">
      document.addEventListener("DOMContentLoaded", () => {
        $(".viewUserBtn").click((evt) => {
          $("#view_user_form").removeClass("d-none");
          $("#new_user_account").addClass("d-none");
        });

        $("#back_to_new_user").click((evt) => {
          $("#view_user_form").addClass("d-none");
          $("#new_user_account").removeClass("d-none");
        });

        $("#fileInputBtn").click((evt) => {
          $("#fileInput").click();
        });

        document
          .getElementById("fileInput")
          .addEventListener("change", function () {
            if (fileInput.files.length > 0) {
              const fileName = fileInput.files[0].name;
              $("#fileInputDetails span:first-child").text(fileName);
              $("#fileInputDetails").removeClass("d-none");
              $("#fileInputBtn").addClass("d-none");
              console.log("Selected file name:", fileName);
            }
          });
        $("#fileInputDetails span:nth-child(2)").click(() => {
          $("#fileInput").val("");
          $("#fileInputDetails span:first-child").text("");
          $("#fileInputDetails").addClass("d-none");
          $("#fileInputBtn").removeClass("d-none");
        });
      });
    </script>

    <script type="text/javascript">
      let holidayIndex = 1;

      function getAccordionItem(index) {
        return `
      <div class="accordion-item" id="accordion-item-${index}">
                  <h2 class="accordion-header" id="flush-heading${index}">
                    <button
                      class="accordion-button collapsed bg-primary-blue text-white fs-14 rounded"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapse${index}"
                      aria-expanded="true"
                      aria-controls="flush-collapse${index}"
                    >
                      Subcategory ${index}
                    </button>
                  </h2>
                  <div
                    id="flush-collapse${index}"
                    class="accordion-collapse collapse show"
                    aria-labelledby="flush-heading${index}"
                    data-bs-parent="#holidayAccordion"
                  >
                    <div class="accordion-body d-flex flex-column gap-4">
                      <div class="form-floating mt-3">
                        <select
                          id="select_sub_cat_${index}"
                          name="select_sub_cat"
                          class="form-select_custom fs-14"
                          required
                        >
                          <option
                            value=""
                            selected
                            style="color: rgb(200, 200, 200)">Select</option
                          >
                          <option value="sub_cat_1">Mixed</option>
                          <option value="sub_cat_2"
                            >Cost of Goods Sold (COGS)</option
                          >
                          <option value="sub_cat_3">OPEX</option>
                          <option value="sub_cat_3">ASSET</option>
                        </select>
                        <label for="select_sub_cat"
                          >Subcategory Selection &nbsp;<span>*</span></label
                        >
                      </div>

                      <div class="form-floating">
                        <textarea class="form-input" rows="2" id="details"
                        ></textarea>
                        <label for="details">Details &nbsp;<span>*</span></label
                        >
                      </div>
                      <div class="form-floating">
                        <input
                          type="text"
                          id="subcat_amount_${index}"
                          name="subcat_amount"
                          class="form-input"
                          placeholder=""
                          required
                        />
                        <label for="subcat_amount">
                          Amount &nbsp;<span>*</span>
                        </label>
                      </div>
                      <div class="form-floating">
                        <input
                          type="date"
                          id="subcat_date_${index}"
                          name="date"
                          class="form-input"
                          placeholder=""
                          required
                        />
                        <label for="subcat_date_${index}">
                          Select Date &nbsp;<span>*</span>
                        </label>
                      </div>

                      <!---- upload ---->
                      <form class="vstack gap-2" id="generate_payslip_form">
                        <div class="fs-14 fw-600">Add Documents</div>
                        <div
                          class="upload_bucket_expense_accordion p-3 d-flex flex-column align-items-center justify-content-center"
                        >
                          <img
                            src="images/png/icons/cloud_upload.svg"
                            width="35px"
                            height="35px"
                            alt="cloud upload icon"
                          />
                          <div class="fs-14 fw-700" style="color: #6B7280">
                            Click to upload <span class="fw-400"
                              >or drag and drop</span
                            >
                          </div>

                          <button
                            type="button"
                            id="fileInputBtn"
                            class="delon-primary-btn d-flex gap-2 mt-2 bg-primary-blue border-0 text-white fs-14"
                          >
                            <img
                              src="images/png/icons/search.svg"
                              alt="arrow-down"
                            />
                            <span>Browse Files</span>
                          </button>
                          <div
                            id="fileInputDetails"
                            class="d-none flex-shrink-1 bg-transparent border text-wrap w-100 py-1 px-2 mt-2 rounded-3 fs-14 d-flex gap-1 align-items-center"
                            role="button"
                          >
                            <span class="flex-fill text-truncate"
                              >gvfyguytctrcjrct.webp</span
                            >
                            <span class="flex-fill">
                              <img
                                src="images/png/icons/close-circle-6.svg"
                                width="15"
                                height="15"
                                alt="close_icon"
                              />
                            </span>
                          </div>
                          <input type="file" class="d-none" id="fileInput" />
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
    `;
      }

      document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("holidayAccordion");
        const addBtn = document.getElementById("addNewHoliday");
        const deleteBtn = document.getElementById("deleteHoliday");

        // Initially hide the delete button
        deleteBtn.style.display = "none";

        function updateDeleteVisibility() {
          const items = container.querySelectorAll(".accordion-item");
          deleteBtn.style.display = items.length > 1 ? "inline-flex" : "none";
        }

        // Add first accordion item on load
        container.insertAdjacentHTML(
          "beforeend",
          getAccordionItem(holidayIndex),
        );
        holidayIndex++;
        updateDeleteVisibility();

        // Add new accordion
        addBtn.addEventListener("click", function () {
          container.insertAdjacentHTML(
            "beforeend",
            getAccordionItem(holidayIndex),
          );
          holidayIndex++;
          updateDeleteVisibility();
        });

        // Delete last accordion
        deleteBtn.addEventListener("click", function () {
          const items = container.querySelectorAll(".accordion-item");
          if (items.length > 1) {
            const lastItem = items[items.length - 1];
            container.removeChild(lastItem);
            holidayIndex--;
            updateDeleteVisibility();
          }
        });

        $("#toggleSwitch").on("change", function () {
          if ($(this).is(":checked")) {
            $("#accordion").hide();
            $("#upload").show();
          } else {
            $("#accordion").show();
            $("#upload").hide();
          }
        });
      });
    </script>
  </main>

  <!-- Main content ends here -->
</Layout>
