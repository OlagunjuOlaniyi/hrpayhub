---
import BreadCrumbs from "../components/ui/BreadCrumbs";
import Layout from "../layouts/Layout.astro";
import DeleteDepartmentModal from "../components/ui/modals/DeleteDepartmentModal";
import AddDepartmentModal from "../components/ui/modals/AddDepartmentModal";
import EditDepartmentModal from "../components/ui/modals/EditDepartmentModal";
---

<style>
  .work_location_select .work_location_select_item:hover {
    background-color: #f0f0f0;
    cursor: pointer;
  }

  .actionButton {
    background-color: transparent;
  }

  .actionButton:hover {
    background-color: rgb(240, 240, 240);
  }
</style>

<Layout title="HRPayHub :: Departments">
  <!-- Main content starts here -->
  <main>
    <!-- First section of Back button and Breadcrumb -->
    <section class="p-4">
      <div class="screenFrame">
        <!-- Back Navigation button and BreadCrumbs -->
        <div class="d-flex flex-md-row flex-column gap-md-5 gap-1 w-full">
          <a
            href="/company-setup"
            title="Back to Payslip"
            class="d-flex gap-2 align-items-center text-decoration-none text-primary-dark"
          >
            <img src="images/png/icons/angle-left.svg" alt="angle-left-back" />
            <span class="fs-16 fw-bold font-avenir-bold">Back</span>
          </a>

          <!-- Actual Breadcrumb here -->
          <BreadCrumbs
            data={[
              { name: "Dashboard", url: "index.html" },
              { name: "Company Setup", url: "company-setup.html" },
              { name: "Departments" },
            ]}
          />
          <!-- Actual Breadcrumb here -->
        </div>
        <!-- Back Navigation button and BreadCrumbs -->
      </div>
    </section>
    <!-- First section of Back button and Breadcrumb -->

    <!-- Main Page content -->
    <section class="px-4">
      <div class="screenFrame">
        <div class="rounded-4 shadow p-4 vstack px-5 employment_status_width">
          {/* Page Title */}
          <div class="vstack gap-2">
            <div class="d-flex gap-3 align-items-center">
              <img
                src="images/png/icons/colored/building.svg"
                alt="receipt-minus-icon"
                width="30px"
                height="30px"
              />
              <span
                class="text-primary-blue font-ubuntu-bold fs-24 inline-block"
                >Company Setup - Departments</span
              >
            </div>
            <div class="fw-bold hidden">&nbsp;</div>
          </div>
          {/* Page Title */}

          {/* Page Content Box */}
          <div class="" id="work_locations_table">
            <div
              class="d-flex flex-column justify-content-between gap-4 border p-4"
              style="border-radius: 10px 10px 0px 0px"
            >
              <div class="font-ubuntu-bold fs-18">Departments</div>
              <div
                class="d-flex flex-column flex-xl-row gap-3 lg:gap-0 justify-content-between lg:align-items-center"
              >
                <div class="d-flex flex-wrap gap-2 w-50 mw-100">
                  <!-- Search input box -->
                  <div
                    class="d-flex align-items-center px-2 gap-1 overflow-hidden"
                    style="background: rgb(250, 250, 250); border: 1px solid #D1D5DB; height: 41px; border-radius: 10px;"
                  >
                    <button class="border-0 bg-transparent py-2">
                      <img
                        src="images/png/icons/search-normal.svg"
                        alt="Search icon"
                        style="margin-top: -3px"
                      />
                    </button>
                    <input
                      type="text"
                      class="flex-fill mw-100 w-100 flex-shrink py-2 bg-transparent border-0 fs-14 rounded-0 no_focus"
                      placeholder="Search..."
                    />
                  </div>
                  <!-- Search input box -->
                </div>
                <div
                  class="d-flex flex-shrink flex-grow-0 flex-column flex-md-row gap-3 lg:align-items-center"
                >
                  <button
                    class="delon-primary-btn bg-primary-blue border-0 text-white fw-600 fs-14 dropdown-toggle dropdown-no-arrow d-flex justify-content-center align-items-center gap-2"
                    type="button"
                    id="addDepartmentBtn"
                  >
                    <span>Add New</span>
                    <img src="images/png/icons/add.svg" alt="arrow-down" />
                  </button>
                </div>
              </div>
            </div>

            <!-- Table section -->
            <table
              class="table table-bordered payslip_table"
              style="table-layout: auto; width: 100%"
            >
              <!-- Table Header -->
              <thead class="bg-primary-blue text-white fs-14 fw-700">
                <th
                  class="bg-primary-blue text-white text-center text-nowrap"
                  style="min-width: 60px">S/N</th
                >
                <th
                  class="bg-primary-blue text-white text-nowrap"
                  style="min-width: 130px">Department</th
                >

                <th
                  class="bg-primary-blue text-white text-center text-nowrap"
                  style="width: 200px">Actions</th
                >
              </thead>
              <!-- Table Header -->
              <tbody class="font-avenir">
                {
                  [
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                    {
                      title: "Lorem 1",
                      created_by: "Joseph Olawale",
                      creation_date: "28 Nov, 2025",
                      creation_time: "9:45PM",
                    },
                  ].map((ele, idx) => (
                    <tr>
                      <td
                        valign="middle"
                        class="text-black text-center px-12px fs-14"
                      >
                        {idx + 1}
                      </td>
                      <td valign="middle" class="text-black px-12px fs-14">
                        {ele.title}
                      </td>

                      <td
                        valign="middle"
                        class="text-black px-12px fs-14 d-flex gap-2 justify-content-center"
                      >
                        <button
                          class="rounded-3 px-2 text-white border-0 text-nowrap actionButton actionButtonEdit d-flex gap-2 align-items-center justify-content-center"
                          style="height: 28px"
                        >
                          <img
                            src="images/png/icons/edit-2.svg"
                            alt="document_file_icon"
                            class="flex-shrink-0"
                          />
                        </button>

                        <button
                          class="rounded-3 px-2 text-white border-0 text-nowrap actionButton actionButtonDelete d-flex gap-2 align-items-center justify-content-center"
                          style="height: 28px"
                        >
                          <img
                            src="images/png/icons/trash.svg"
                            alt="document_file_icon"
                            class="flex-shrink-0"
                          />
                        </button>
                      </td>
                    </tr>
                  ))
                }
              </tbody>
            </table>
            <!-- Table section -->

            <!-- Pagination Row -->
            <div
              class="d-flex justify-content-between align-items-center m-2 flex-wrap gap-3 pt-3"
            >
              <!-- Left: Pagination Text -->
              <div class="fs-14 text-muted">
                Showing <strong>1–20</strong> of <strong>1000</strong>
              </div>

              <!-- Right: Go to Page + Pagination -->
              <div class="d-flex align-items-center gap-3 flex-wrap">
                <!-- Go to Page -->
                <form class="d-flex align-items-center gap-2">
                  <label for="gotoPage" class="fs-14 mb-0">Go to page?</label>
                  <input
                    type="number"
                    min="1"
                    max="100"
                    id="gotoPage"
                    class="form-control form-control-sm"
                    style="width: 60px;"
                    placeholder="—"
                  />
                </form>

                <!-- Page Navigation -->

                <nav>
                  <ul class="pagination pagination-sm mb-0 text-primary-blue">
                    <li class="page-item">
                      <a
                        class="page-link text-primary-blue px-2"
                        href="#"
                        aria-label="Previous"
                      >
                        &lsaquo;
                      </a>
                    </li>
                    <li class="page-item">
                      <a class="page-link text-primary-blue" href="#">1</a>
                    </li>
                    <li class="page-item active" aria-current="page">
                      <span class="page-link">2</span>
                    </li>
                    <li class="page-item">
                      <a class="page-link text-primary-blue" href="#">3</a>
                    </li>
                    <li class="page-item disabled">
                      <span class="page-link text-primary-blue">...</span>
                    </li>
                    <li class="page-item">
                      <a class="page-link text-primary-blue" href="#">100</a>
                    </li>
                    <li class="page-item">
                      <a class="page-link hello" href="#" aria-label="Next">
                        &rsaquo;
                      </a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
            <!---- Pagination ---->
          </div>
          {/* Page Content Box */}
        </div>
      </div>
    </section>
    <AddDepartmentModal />
    <DeleteDepartmentModal />
    <EditDepartmentModal />
  </main>
  <!-- Main content ends here -->

  <!-- Notfy -->
  <script is:inline src="libs/notyf/notyf.min.js"></script>

  <script is:inline>
    let targetLocationToDelete;
    var notyf = new Notyf({
      position: {
        x: "center",
        y: "top",
      },
    });

    document.addEventListener("DOMContentLoaded", () => {
      // Modal Object declared here
      const myModal = new bootstrap.Modal("#deleteDepartmentModal", {
        keyboard: true,
      });

      const myEditModal = new bootstrap.Modal("#editDeptModal", {
        keyboard: true,
      });
      // Modal Object declared here

      $("#addDepartmentBtn").click((e) => {
        const myModal = new bootstrap.Modal("#addDeptModal", {
          keyboard: true,
        });
        myModal.show();
      });

      $(".actionButtonEdit").on("click", function (evt) {
        const html = $(this).html();
        $(this).html(`
              <span>
                  <span class="spinner-border spinner-border-sm text-dark" aria-hidden="true"></span>
              </span>
          `);

        setTimeout(() => {
          myEditModal.show();
          $(this).html(html);
        }, 1500);
      });

      $(".actionButtonDelete").on("click", function (evt) {
        const html = $(this).html();
        targetLocationToDelete = this;

        $(this).html(`
            <span>
                <span class="spinner-border spinner-border-sm text-dark" aria-hidden="true"></span>
            </span>
        `);

        setTimeout(() => {
          if (Math.random() < 0.5) {
            // 80% chance of success
            myModal.show();

            $(this).html(html);
          } else {
            // 20% chance of failure
            notyf.error(
              "This is a sample notification shown for delete operation!",
            );
            $(this).html(html);
            console.log("No delete");
          }
        }, 1000);
      });

      $("#deleteDeptConfirmBtn").click(() => {
        $(targetLocationToDelete).closest("tr").remove();
        notyf.success("The department have been successfully deleted!");
        myModal.hide();
      });
    });
  </script>
</Layout>
