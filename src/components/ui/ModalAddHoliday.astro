---
// components/ui/ModalAddNew.astro
const {
  modalId = "myModal",
  title = "Add Holiday",
  inputPlace = "Work Location",
} = Astro.props;
import { CloseCircleIcon } from "../Icons";
---

<div class="modal fade" id={modalId} tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content p-5">
      <!-- Modal Header -->
      <div class="modal-header border-0 d-flex justify-content-between">
        <h4 class="modal-title fs-22 fw-700" id="modalTitle">{title}</h4>

        <img
          type="button"
          data-bs-dismiss="modal"
          src="images/png/icons/close-circle-1.svg"
          alt="close"
        />
      </div>

      <!-- Modal body -->

      <div class="modal-body d-flex flex-column gap-4 py-5 border-0">
        <div class="form-floating">
          <select
            id="work_location"
            name="work_location"
            class="form-select_custom fs-14"
            required
          >
            <option value="" selected> Select </option>
            <option value="1">E1001</option>
            <option value="2">E1002</option>
            <option value="3">E1003</option>
          </select>
          <label for="work_location">
            Branch &nbsp;<span>*</span>
          </label>
        </div>

        <!------ Accordion ---->

        <div
          class="accordion accordion-flush d-flex flex-column gap-3"
          id="holidayAccordion"
        >
        </div>

        <!------ Add New Button ------>

        <div class="d-flex justify-content-end align-items-center">
          <button
            type="button"
            class="white_button fs-14 d-flex gap-1 align-items-center"
            id="deleteHoliday"
            style="border: 0px !important;"
          >
            <span>Delete </span>
            <img src="images/png/icons/colored/delete.svg" alt="delete" />
          </button>
          <button
            type="button"
            class="white_button fs-14 d-flex gap-1 align-items-center"
            id="addNewHoliday"
            style="border: 0px !important;"
          >
            <span>Add New </span>
            <img src="images/png/icons/add.svg" alt="add new" />
          </button>
        </div>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer border-0">
        <button
          type="button"
          class="btn bg-primary-blue text-white"
          data-bs-dismiss="modal"
        >
          Save
        </button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  let holidayIndex = 1;

  function getAccordionItem(index) {
    return `
      <div class="accordion-item" id="accordion-item-${index}">
        <h2 class="accordion-header" id="flush-heading${index}">
          <button
            class="accordion-button collapsed bg-primary-blue text-white fs-14 rounded"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#flush-collapse${index}"
            aria-expanded="true"
            aria-controls="flush-collapse${index}"
          >
            Holiday ${index}
          </button>
        </h2>
        <div
          id="flush-collapse${index}"
          class="accordion-collapse collapse show"
          aria-labelledby="flush-heading${index}"
          data-bs-parent="#holidayAccordion"
        >
          <div class="accordion-body d-flex flex-column gap-4">
            <div class="form-floating mt-3">
              <input
                type="text"
                id="holiday_name_${index}"
                name="holiday_name[]"
                class="form-input"
                placeholder=""
                required
              />
              <label for="holiday_name_${index}">
                Holiday Name &nbsp;<span>*</span>
              </label>
            </div>

            <div class="form-group mt-3">
                    <label for="holiday_range" class="form-label fs-14"
                      >Select Holiday &nbsp;<span class="text-danger">*</span></label
                    >
                    <input
                      type="text"
                      id="holiday_range_${index}"
                      name="holiday_range[]"
                      class="form-control fs-14 py-3"
                      placeholder="Select date"
                      autocomplete="off"
                    />

                  </div>
            
          </div>
        </div>
      </div>
    `;
  }

  document.addEventListener("DOMContentLoaded", function () {
    const container = document.getElementById("holidayAccordion");
    const addBtn = document.getElementById("addNewHoliday");
    const deleteBtn = document.getElementById("deleteHoliday");

    // Initially hide the delete button
    deleteBtn.style.display = "none";

    function updateDeleteVisibility() {
      const items = container.querySelectorAll(".accordion-item");
      deleteBtn.style.display = items.length > 1 ? "inline-flex" : "none";
    }

    // Add first accordion item on load
    container.insertAdjacentHTML("beforeend", getAccordionItem(holidayIndex));
    initFlatpickr(holidayIndex);

    holidayIndex++;
    updateDeleteVisibility();

    // Add new accordion
    addBtn.addEventListener("click", function () {
      container.insertAdjacentHTML("beforeend", getAccordionItem(holidayIndex));
      initFlatpickr(holidayIndex);
      holidayIndex++;
      updateDeleteVisibility();
    });

    // Delete last accordion
    deleteBtn.addEventListener("click", function () {
      const items = container.querySelectorAll(".accordion-item");
      if (items.length > 1) {
        const lastItem = items[items.length - 1];
        container.removeChild(lastItem);
        holidayIndex--;
        updateDeleteVisibility();
      }
    });

    // Initiate date range
    function initFlatpickr(index) {
      flatpickr(`#holiday_range_${index}`, {
        mode: "range",
        dateFormat: "Y-m-d",
      });
    }
  });
</script>
